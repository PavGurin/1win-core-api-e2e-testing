image:
  name: node:8.16.0-alpine


variables:
  DOCKER_HOST: tcp://docker:2375/
  DOCKER_DRIVER: overlay2

services:
  - docker:dind

stages:
  - tests

.api_test: &api_test
  stage: tests
  tags:
  - docker
  allow_failure: true
  script:
    - npm i
    - npm run test:junit-report
  artifacts:
    reports:
      junit: artifacts/test-output.xml

backend_staging:
  variables:
    TEST_URL: https://1win.dev/
    TEST_FILTER: "@master"
  <<: *api_test

backend_production:
  when: manual
  variables:
    TEST_URL: https://1winufeg.xyz/
    TEST_FILTER: "@dev"
  <<: *api_test